
/*
 * -------------------------------------------------------
 * Project: Livi18n.js
 * Version: 0.1.0
 *
 * Author:  Christopher EnyTC
 * Site:     http://chris.enytc.com
 * Contact: chrisenytc@gmail.com
 *
 *
 * Copyright (c) 2013 Christopher EnyTC
 * -------------------------------------------------------
 */

"use strict";window.livi18n=function($,$window,$document){var checkData,config,getData,getFileName,getKey,getProperty,initialize,jQi,p,pluralize,require,t,translate,version;return config={},version="0.1.0",initialize=function(domain,filenames,cb){return void 0===jQuery?(console.error("jQuery is required but is not defined"),void 0):(config.domain=domain,config.filenames=filenames,config.data={},cb=cb||function(){},jQi(),1===filenames.length?getData(filenames[0]):$.each(filenames,function(key,val){return getData(val)}),$($document).ajaxSuccess(function(){return checkData()?$("body").trigger("livi18n.loaded"):void 0}),$("body").on("livi18n.loaded",function(){return cb(t,p)}))},jQi=function(){return $.fn.livi18nT=function(options){var cItem,item,key;return options=options||{},$(this).children().length>0?(cItem=$(this).children(),cItem.each(function(){var cOptions,i,item,key,parseOptions;if(cOptions=options||{},item=$(this),key=item.data("livi18n"),options.enableOptions){parseOptions=item.data();for(i in parseOptions)cOptions[i]=parseOptions[i]}return item.removeData(),cOptions.key=key,item.text(t(cOptions))})):(item=$(this),key=item.data("livi18n"),item.removeData(),options.key=key,item.text(t(options)))},$.fn.livi18nP=function(options){var cItem,item,key;return options=options||{},$(this).children().length>0?(cItem=$(this).children(),cItem.each(function(){var cOptions,i,item,key,parseOptions;if(cOptions=options||{},item=$(this),key=item.data("livi18n"),options.enableOptions){parseOptions=item.data();for(i in parseOptions)cOptions[i]=parseOptions[i]}return item.removeData(),cOptions.key=key,item.text(p(cOptions))})):(item=$(this),key=item.data("livi18n"),item.removeData(),options.key=key,item.text(p(options)))}},require=function(fn){return $("body").on("livi18n.loaded",function(){return fn(t,p)})},getProperty=function(key,obj){var i,len,p;for(p=key.split("."),i=0,len=p.length;len-1>i;)obj=obj[p[i]],i++;return obj[p[len-1]]},translate=function(data,key,options,defaultValue){var e,o,pattern,re,value;defaultValue=defaultValue||"";try{value=getProperty(key,data)}catch(_error){e=_error,value=void 0}if(void 0===value)return defaultValue;for(o in options)pattern=":"+o,re=new RegExp(pattern,"g"),value=value.replace(re,options[o]);return value},pluralize=function(data,key,options,nValue,defaultValue){var e,o,pattern,re,spValue,value;defaultValue=defaultValue||"";try{value=getProperty(key,data)}catch(_error){e=_error,value=void 0}if(void 0===value)return defaultValue;spValue=value.split("||"),value=nValue>1?spValue[1]:spValue[0];for(o in options)pattern=":"+o,re=new RegExp(pattern,"g"),value=value.replace(re,options[o]);return value=value.replace(/:&:/g,nValue)},checkData=function(){var length;return length=0,$.each(config.data,function(){return length++}),length===config.filenames.length?!0:!1},getFileName=function(key){var string;return string=key.split("."),string[0]},getKey=function(key){var string,value;return string=key.split("."),string.shift(0),value=string.join(".")},getData=function(filename){return config.data.hasOwnProperty(filename)?config.data[filename]:$.ajax({type:"GET",url:config.domain+"/livi18n/"+filename,dataType:"json",success:function(data){return config.data[filename]=data},error:function(){return console.log("error: "+filename+" not found!")}})},t=function(data){var defaultValue,filename,key,options;return options=data.options||{},defaultValue=data.defaultValue||"",key=getKey(data.key),filename=getFileName(data.key),translate(getData(filename),key,options,defaultValue)},p=function(data){var defaultValue,filename,key,options,value;return options=data.options||{},defaultValue=data.defaultValue||"",key=getKey(data.key),value=data.value,filename=getFileName(data.key),pluralize(getData(filename),key,options,value,defaultValue)},{version:version,loaded:checkData,init:initialize,require:require,t:t,p:p}}(jQuery,window,document);